# MangoLee后端错误码设计

## 总览
MangoLee项目前后端分离，使用JSON格式前后传递序列化数据。JSON规范字段如下:
```json
{
  "code": "0000",
  "message": "OK",
  "data": null //实际承载数据对象
}
```
本设计方案针对`code`字段进行域限定以及定义枚举，
并对`message`字段的相对应消息做建议。

## 域限定
`code`字段强制为4位数字字符组成的字符串。
若其为`"0000"`则表示请求被服务正常处理，正常返回，
对应`message`建议为"OK"或”成功“。

除此以外的所有组合都应当被认定为请求处理失败，或请求未能达成效果。
请求失败有多种可能性，”域限定“指对失败请求的原因作归类，
不同域拥有不同的开头数字

+ 用户域 "1xxx"
+ 权限域 "2xxx"
+ 访问限制域 "3xxx"
+ 微服务域 "4xxx"
+ 系统域 "5xxx"

其中用户域和权限域对于整体系统属于可以容忍的业务范围，或可被处理的错误结果。
而访问限制域，微服务域，和系统域对于整体系统属于异常。
### 用户域 "1xxx"
本域中的错误根本上来自用户的操作，向上传递 
"本请求使用的**服务**正常工作，但由用户的**不当操作**导致此请求失败"
的意味。

例如：在身份管理功能，用户填写了错误格式的生日；
在图片上传功能，用户上传了非图片文件；
在博客页管理功能，用户试图删除不存在的博客页。

### 权限域 "2xxx"
本域中的错误根本上来自用户的权限问题，向上传递
"本请求使用的**服务**正常工作，但用户拥有的**权限**并不匹配此请求"
的意味。

例如：用户不携带token访问非公共资源或服务；
用户携带已过期token访问服务；
用户访问不匹配自身权限角色的服务。

### 访问限制域 "3xxx"
本域的错误主要来自api网关的请求攻击拦截，访问黑名单，或反爬虫。
一般不由除了api网关外的其他微服务组件产生。向上传递
"本请求触发了访问限制"
的意味。

### 微服务域 "4xxx"
本域中的错误根本上来自某些微服务不能正常工作，属于微服务的异常情况。
向上传递 "微服务组件**功能异常**导致本请求失败"
的意味。

例如：由于注册中心下线导致feign远程调用失败；
微服务所调用的端口无响应；
微服务内JSON反序列化异常；

### 系统域 "5xxx"
本域中的错误根本上来自UNIX系统无法正常工作，也属于微服务的异常情况。
向上传递 "微服务所在的UNIX系统**功能异常**导致本请求失败"
的意味。

例如：系统磁盘空间耗尽；
服务器硬件无响应；
申请内存失败；